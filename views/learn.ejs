<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head') %>
<body class="bg-zinc-50 text-gray-800 max-w-screen-lg mx-auto my-6">
  
  <!-- <%- include('./partials/links') %> -->

  <div id="lectures" class="lg:w-1/3 bg-white rounded-lg shadow-lg p-6 overflow-y-scroll top-8 self-start hidden">
    <h3 class="text-2xl font-bold mb-4 text-gray-800">Course Content</h3>
    <div id="lectures-content" class="space-y-4">
      <!-- Lectures will be dynamically inserted here -->
    </div>
  </div>
</div>

  <!-- Main Content -->
  <div class="space-y-4 mt-8">
      <!-- Video Player and Description -->
    <div class="flex justify-end gap-4 items-center">

      <button class="p-2 border-2 border-black shadow-md" onclick="document.getElementById('lectures').classList.toggle('hidden')">
        <i data-feather="menu"></i>
      </button>

      <div class="bg-white flex border-2 divide-x-2 border-black divide-black">
        <button class="p-2"><i data-feather="chevron-left"></i></button>
        <button class="p-2 px-4 font-medium">Lectures</button>
        <button class="p-2"><i data-feather="chevron-right"></i></button>
      </div>

    </div>

    <iframe id="lecture-video" class="w-full h-full aspect-video rounded-lg shadow-xl" 
      frameborder="0" 
      allow="autoplay; encrypted-media"
      allowfullscreen>
    </iframe>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
  <script>
    feather.replace();

    let currentLecture = null;
    let courseData = null;

    async function fetchCourseDetails() {
      try {
        const response = await fetch('http://127.0.0.1:3000/public/courses/content/<%= course.playlistId %>.json');
        courseData = await response.json();

        const lecturesElement = document.querySelector('#lectures-content');
        lecturesElement.innerHTML = `
          <ul class="space-y-4">
            ${courseData.course.lectures.map((lecture, index) => `
              <li class="flex items-center justify-between py-2 ${index !== courseData.course.lectures.length - 1 ? 'border-b border-gray-200' : ''} cursor-pointer hover:bg-gray-100" onclick="changeLecture(${index})">
                <div class="flex items-center w-2/3">
                  <span class="text-gray-400 mr-3">
                    <i data-feather="play-circle" class="h-6 w-6 stroke-1"></i>
                  </span>
                  <span class="text-gray-800 truncate">${lecture.title}</span>
                </div>
                <span class="text-sm font-medium text-gray-600">${Math.floor(lecture.duration / 60)} min</span>
              </li>
            `).join('')}
          </ul>
        `;

        // Set the first lecture as current
        changeLecture(0);

      } catch (err) {
        console.error(err);
        const lecturesElement = document.querySelector('#lectures-content');
        lecturesElement.innerHTML = `
          <div class="text-center text-red-600">
            <p>Failed to load lectures. Please try again later.</p>
          </div>
        `;
      }

      feather.replace();

    }

    function changeLecture(index) {
      currentLecture = courseData.course.lectures[index];
      updateLectureContent();
    }

    function updateLectureContent() {
      if (currentLecture) {
        document.getElementById('lecture-video').src = currentLecture.embed + '?autoplay=0&amp;mute=0&amp;controls=1&amp;origin=https%3A%2F%2Facegrade.in&amp;playsinline=1&amp;showinfo=0&amp;rel=0&amp;iv_load_policy=3&amp;modestbranding=1&amp;enablejsapi=1&amp;widgetid=1';
        document.getElementById('lecture-title').textContent = currentLecture.title;
        document.getElementById('lecture-description').textContent = currentLecture.description;
      }
    }

    fetchCourseDetails();
  </script>
</body>
</html>